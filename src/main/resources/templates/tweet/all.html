<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>Twitter</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script th:src="@{/webjars/jquery/3.0.0/jquery.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}"/>
    <link href="../static/css/main.css" th:href="@{/css/main.css}" rel="stylesheet"/>
</head>
<body>
<header th:include="fragments/header :: pageheader"></header>
<p th:if="${#authentication.getPrincipal().getUser().getId()}==${userId}">
<a th:href="@{/twitter/add}">Add new tweet</a>
</p>
<p th:if="${#authentication.getPrincipal().getUser().getId()}!=${userId}">
    <a th:href="@{/message/send/{id}(id=${userId})}">Send message</a>
</p>

<table border="1">
    <tr>
        <th>User</th>
        <th>Text</th>
        <th>Created</th>
        <th>Comments number</th>
        <th>Actions</th>
    </tr>
    <tr th:each="tweet: ${tweets}">
        <td>
            <a th:href="@{/twitter/{id}(id=${tweet.user.id})}"><p th:text="${tweet.user.name}"></p></a>
        </td>
        <td th:text="|${#strings.abbreviate(tweet.text,30)}"></td>
        <td th:text="${#temporals.format(tweet.created, 'dd-MM-yyyy HH:mm')}"></td>
        <td th:text="${#lists.size(tweet.comments)}"></td>
        <td>
            <a th:href="@{/twitter/details/{id}(id=${tweet.id})}">Details</a>
            <p th:if="${#authentication.getPrincipal().getUser().getId()}==${tweet.user.id}">
                <a th:href="@{/twitter/edit/{id}(id=${tweet.id})}">Edit</a>
                <a th:href="@{/twitter/delete/{id}(id=${tweet.id})}">Delete</a>
            </p>
        </td>
    </tr>
</table>
<br>
<span th:if="${#authentication.getPrincipal().getUser().getId()}==${userId}">
<form th:action="@{/twitter/add}" method="post" th:object="${tweet}">
    <input type="hidden" name="id"  th:field="*{id}" />
    <input type="hidden" name="user"  th:field="*{user}" />
    <input type="hidden" name="created"  th:field="*{created}" />
    <div><label> Text : <textarea name="text" th:field="*{text}"></textarea></label></div>
    <div th:if="${#fields.hasErrors('text')}" th:errors="*{text}">Text error</div>
    <div><input type="submit" value="Save"/></div>
</form>
</span>
</body>
</html>